import sys
from collections import OrderedDict
import numpy as np
from bokeh.plotting import figure, show, output_file

import pprint
pp = pprint.PrettyPrinter(indent=4)

def get_quantiles(data):
    # data is a list of lists
    final = []
    for i in data:
        q1 = np.percentile(i, 25)
        q2 = np.percentile(i, 50)
        q3 = np.percentile(i, 75)
        iqr = q3 - q1
        final.append((q1 - 1.5*iqr, q3 + 1.5*iqr,q1, q2,  q3,  [x for x in i if x < q1 - (1.5 * iqr) or x >q3 + (1.5 * iqr)  ]))
    return final


def make_box_raw(p, cats, upper, lower, q1, q2, q3, out):
    p.segment(cats, lower, cats, upper)
    p.vbar(cats, 0.7, q1, q2, fill_color="#E08E79", line_color="black")
    p.vbar(cats, 0.7, q2, q3, fill_color="#3B8686", line_color="black")
    p.rect(cats, lower, 0.2, 0.01, line_color="black")
    p.rect(cats, upper, 0.2, 0.01, line_color="black")
    for k, v in out.items():
        for point in v:
            p.circle([k], [point], size=6, color="#F38630", fill_alpha=0.6)
    show(p)

def zip_data(cats, data):
    zip_data = list(zip(*data))
    outs = OrderedDict()
    for counter, i in enumerate(cats):
        if len(zip_data[5][counter]) != 0:
            outs[i] = zip_data[5][counter]
    return zip_data, outs

def make_box(cats, data):
    p = figure(tools="save", background_fill_color="#EFE8E2", title="box plot", x_range=cats)
    f, outs = zip_data(cats, get_quantiles(data))
    make_box_raw(p, cats, f[0], f[1], f[2], f[3], f[4], outs)

if __name__ == '__main__':
    data = [[ 0.01719573,  0.00638024,  1.32234547,  1.29507579, -0.9780301 ,
       -0.4042007 , -0.52869903,  0.57402383, -1.06777475, -0.57652379,
        0.57700681,  0.64252344, -0.49745017, -1.10139402, -0.20158941,
       -1.04136309, -0.81743054,  0.71311006, -0.42053463,  0.9368777 ,
       -0.13712781,  0.65742225,  0.76731297, -0.31056899,  1.11512929,
       -0.54528396, -0.62213991, -2.22939313,  2.92061303,  0.15426043,
        0.78968865, -0.19938927, -0.88574611,  0.30615773,  0.96925045,
        0.27845962,  0.71930377,  0.17202406, -0.30466886,  0.54330928,
       -1.09444807,  0.67426299, -2.4894672 , -0.48556772, -0.31856383,
        0.14653904,  0.55617306,  0.69161392,  1.07431505,  0.42973066,
       -0.42053362, -1.0374921 , -1.20297352, -0.3168716 , -1.5552553 ,
       -0.39777115, -0.29912482,  0.23816158,  1.2028703 , -0.50465246,
       -2.45238892,  0.0948544 , -0.44907006,  1.26292688,  0.40952997,
        1.81989921, -1.71976414, -0.84889591, -1.03900943, -1.48835832,
        0.75469072,  1.78578247, -1.62204014,  0.76771625, -0.29708458,
       -0.17362922,  0.42917202, -0.02650094,  0.39527087,  0.0536184 ,
        1.07638749, -0.80274872, -1.69358536, -0.398803  , -0.46648471,
       -1.65344313, -0.38067911,  0.34739499,  1.23256392, -0.00543302,
        0.0199104 ,  1.02247777, -1.16245671, -1.07320367,  0.21732508,
        1.57005939,  0.62043615,  0.91571408, -0.84346323,  0.92196308,
        1.00906931,  1.80956143,  1.4771811 , -1.03445794,  0.27306063,
       -1.0260193 , -0.99428469, -1.6673356 , -1.8755674 ,  0.43383341,
       -0.54139306, -0.47998103,  1.1018926 , -0.30070547,  0.89201361,
        0.12142417, -0.17459665, -1.63574659,  0.32585007,  0.6557681 ,
        0.42819226,  0.48825267, -1.05294974,  0.36211306,  0.26940987,
        0.36537784, -0.62900696,  0.79099837,  1.01187651, -0.37715565,
       -1.22515389,  0.33467506, -2.15954784,  1.16873949, -1.63977577,
        1.06820055,  1.01110525,  1.15983446,  1.93471072,  0.0485327 ,
       -2.45216665,  0.47705344,  0.10795587,  1.54461265, -0.28497931,
        1.57982597,  0.33494374, -0.84440101, -0.15678805,  0.24477768,
        2.21433143,  0.82750052,  1.0710393 ,  0.50885913,  0.17105889,
       -1.05105105,  0.43936602, -0.84308362,  0.81685235,  1.27841764,
        0.98180828, -2.02245793, -0.65195457, -0.13181775,  2.03160088,
        0.12506945,  1.30570462,  0.22709371, -1.14923572,  1.19715171,
        1.14229219,  0.17182081,  0.70982772,  1.4048775 ,  1.59018025,
       -0.8079621 ,  0.12491628, -0.22900935,  0.9189805 ,  0.09524525,
       -0.32303087,  0.31524156,  0.23434369,  1.48234346,  1.19441275,
        1.18176886, -1.96864877,  0.83424685,  1.85808397,  1.1750176 ,
        0.19583958,  0.14364929,  0.06077048,  0.09986079, -0.42521097,
        0.25312224,  0.53294719, -0.81278532,  0.63606204, -0.49533489],
        [-0.39676943, -1.43024274, -0.77372069,  0.25292883,  0.30821124,
       -0.01455833, -1.5447982 , -0.92995116, -1.26832352,  0.5274599 ,
       -1.00488887, -0.16180953,  0.30892768, -0.4379863 , -0.68228773,
        0.69858099,  0.76852622, -0.67722486,  0.62908874,  2.20724783,
        1.34276038, -0.74171734,  0.40238189,  0.20066448, -0.42004532,
        1.74275914, -2.2417759 , -1.18331375, -0.6947324 , -0.35308432,
        0.61353683,  1.2338782 , -0.15538923,  1.97554934, -1.32845394,
        0.30820803,  0.44809637, -1.91680682, -0.68573281, -0.01294044,
        1.65753889, -1.29496863, -0.93775068, -0.74103119, -0.79372808,
       -0.45510083, -0.97030151, -2.55902142, -1.88418366, -0.76406224,
       -1.05225799, -0.13868762, -1.54129772, -0.33842271, -0.5624471 ,
       -0.38214889,  0.52078904, -1.05142927,  0.25459672,  0.05467433,
       -0.24581932, -1.79463567,  0.74203293,  0.69018438,  0.32970009,
        0.16335028, -0.42845906, -0.15710528, -0.71619639, -0.12071961,
       -0.22433223,  0.07233969,  1.2267857 , -2.28808884,  0.36518416,
       -0.89256557, -1.12031496, -1.32419194, -1.11814218, -0.96449108,
        0.59190046, -0.2583867 , -0.78770374,  1.224218  , -1.13963404,
        0.27749735, -2.30041185,  0.70228239, -2.22355457,  1.78176894,
       -0.78021734, -1.19183887,  0.89582779, -0.98119822, -1.38285327,
       -0.72172872,  0.96190466, -0.37214291, -1.72090088,  0.16810281,
       -0.72793697, -0.68366315,  0.80693479,  0.45875126, -1.6020775 ,
        0.79708283,  1.18250397, -0.93319874, -0.43876023, -0.6418746 ,
       -0.93232543,  0.58134006,  0.11136081,  0.33433085,  0.57566967,
       -1.05320471, -0.81534919, -1.04009762,  0.90371095, -0.28658277,
       -0.76900095, -1.73337293, -1.45453521, -0.25854716,  0.29162616,
        0.37432183,  1.23814678,  0.47516571,  0.47057103,  0.13490658,
        0.58292879, -1.45795746, -1.47773494, -0.83643036,  0.91004109,
       -0.07621669, -0.00811801, -0.80725115, -0.55129045,  0.03086176,
       -0.07527263,  0.09987143, -0.98878352,  0.54742322, -0.60109859,
        0.12015268, -0.79767874, -0.06285715, -0.67098721, -0.43843085,
       -0.08972336,  1.1597498 ,  1.01492674, -0.70165993, -0.05666763,
       -1.92114646, -0.13959486,  1.75548649, -0.42530017, -0.22890191,
        0.62501118, -1.34613471,  0.14743006, -1.45927785,  0.35430868,
       -1.11819747,  1.30162924,  0.92987711, -0.04689576, -0.9238585 ,
        0.28718162,  0.87297007, -1.4041085 ,  1.86109238, -0.14941376,
       -0.88365882, -0.578484  ,  0.27092084,  0.40402486,  0.32287589,
        1.52835369, -0.79682886,  0.27973394, -0.75260172, -0.93701735,
       -0.97621741, -1.16063982,  0.80295421,  0.94893144, -0.44192964,
        0.73802763,  1.45508153,  0.16214601, -0.19767922, -0.87052829,
       -1.31159879, -0.91842138,  1.15936223,  0.9042821 ,  0.06211876],
       [ 7.20691123e-02, -1.48291733e+00, -1.83020916e+00, -6.53249558e-01,
        2.24009376e-01, -6.13355851e-01,  6.77708437e-01,  8.89164377e-01,
        5.47241522e-01, -4.43376028e-01,  8.08755262e-01,  1.91256743e+00,
        1.23952846e+00, -1.58284070e+00,  6.95640295e-01, -6.99049607e-01,
        6.42990376e-01,  1.08455214e-01, -1.51018269e-01,  9.68305953e-01,
        2.06744001e+00,  1.67784261e+00, -4.11204251e-01,  3.33254740e-01,
       -1.39354315e-01, -8.52445761e-01, -3.10933239e-01, -1.69937008e-01,
       -9.86181336e-01,  1.69264011e+00, -3.60680453e-01,  4.09743784e-01,
       -1.13351842e+00,  9.02527780e-01,  6.78827442e-01, -2.35279333e-01,
       -3.06723230e-01, -1.53034821e+00,  6.29924698e-01,  6.11087509e-01,
        4.52889898e-01,  1.07209306e+00,  2.21495380e+00,  7.50388147e-02,
       -8.26654432e-01, -7.65174644e-02,  6.66410441e-01,  1.83786907e+00,
        2.15942348e+00,  3.36445721e-02,  1.09172187e+00,  5.18721787e-01,
        6.35157053e-01,  2.74265916e-01, -3.78610398e-01,  2.73609907e-01,
       -1.27851188e+00, -8.63907371e-01, -1.87618582e+00,  8.41903264e-01,
       -4.45773926e-01,  3.08720871e-01, -3.34309946e-01, -3.97406330e-01,
        4.04178692e-01,  2.59764534e-01,  1.95332062e+00,  1.22979180e+00,
        4.58209083e-01,  1.64960425e-01, -1.23203955e+00, -2.15903119e+00,
        4.49680912e-01, -1.08109779e+00, -6.22365477e-01,  8.45454619e-01,
       -1.76583245e+00,  1.05931965e+00, -3.24613635e-01, -7.65336695e-01,
        2.66122588e-01, -4.24342733e-01,  3.29563405e-01,  1.04525018e+00,
       -6.51662655e-01, -4.36713013e-01,  5.98596887e-01,  8.05812668e-01,
        9.20076929e-01, -1.30909557e+00,  1.32340549e-01, -4.11460768e-03,
       -1.80575447e-01, -2.71559093e+00, -5.61631862e-01,  1.83749857e+00,
       -4.18012401e-01,  7.35877614e-03,  9.21350929e-02,  1.71944609e+00,
        3.77767102e-01,  1.34783064e+00, -6.45622416e-01,  6.02831431e-01,
        1.50286314e+00, -1.30711397e+00,  5.22419636e-01,  2.05926979e+00,
        1.04638140e+00, -5.27116593e-02,  2.67812614e-02, -6.61531839e-01,
        2.83026722e-01, -2.24848803e+00, -9.72559322e-01,  3.20942592e-01,
        1.59893540e+00,  2.16018734e-01,  6.84861043e-01, -5.65661479e-01,
       -7.82124699e-01,  8.10489411e-02, -9.72005764e-01,  7.64411981e-01,
        1.37579071e+00,  4.83058119e-01, -7.13812041e-01, -2.15903679e+00,
       -5.42772375e-01, -4.66331602e-02,  8.69934669e-01, -1.68157302e+00,
        7.03064766e-01,  2.10702204e+00,  3.23258264e-01, -1.23479599e+00,
       -2.05691377e-01,  2.25345988e-01, -5.49483459e-01,  3.99978282e-01,
       -2.99499118e-01, -1.29057738e+00, -8.40100472e-01, -2.55057906e-01,
        4.21232904e-01,  6.94403357e-01, -5.80379516e-01, -1.49983868e+00,
       -1.00405324e+00,  1.74336152e+00,  1.29392309e+00, -6.83634995e-01,
       -3.03751120e-01,  7.04202221e-01, -1.98275647e-01,  8.30679509e-01,
        1.14399366e+00,  1.31240520e+00,  6.41359229e-03, -5.93539464e-01,
        8.07692943e-01, -2.06029685e-01, -3.02734539e-01,  4.24384086e-01,
        1.45994518e-01,  1.35184007e+00, -9.20846917e-01,  3.68369502e-02,
       -6.72847470e-01, -4.15258935e-01, -1.72663227e+00,  3.51475569e-01,
        8.45858988e-01,  2.21320702e+00, -6.31074535e-01,  1.11959499e+00,
        1.08273851e+00, -1.41082601e-01, -1.05302438e+00,  1.44976834e+00,
        2.27240119e+00, -9.06571693e-01, -1.37101701e-01, -2.32080032e-03,
        8.25755247e-01, -8.03672933e-01, -1.48121589e+00, -1.27556868e+00,
       -1.55186790e+00,  5.33087084e-01,  2.41270479e-01, -7.19843339e-01,
        1.15890641e+00,  1.29157928e+00, -1.89006039e+00,  4.18250891e-01,
        1.67368431e+00, -1.47469192e-01, -1.21855208e+00, -1.96853405e-01]]
    cats = ['a', 'b', 'c']
    make_box(cats, data)


